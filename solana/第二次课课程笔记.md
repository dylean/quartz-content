---
title: 第二次课课程笔记：Solana 狙击机器人与代币开发实战
slug: solana-second-class
published: 2026-01-16
description: 深度解析 Solana 狙击机器人 (Sniper Bot) 的核心原理（Jito, Websocket, Mempool 差异）以及 SPL Token 开发实战。
tags:
  - Solana
  - Sniper Bot
  - Jito
  - SPL Token
  - Web3.js
category: Web3
draft: false
---

> [!TIP]
> **课程概览**
>
> * **主题**: Solana 链上狙击机器人 (Sniper Bot) 原理与实战 & Solana Token 账户模型深度解析
> * **第一部分 (诺亚 Noah)**: 狙击机器人开发 (架构、Jito、Websocket、安全检查)
> * **第二部分 (潘立雄)**: Solana 账户模型、SPL Token 标准、命令行与代码发币实战

---

## 第一部分：Solana 狙击机器人开发实战 (Sniper Bot)

**主讲人**: 诺亚 (Noah)

### 1. 核心概念与优势

* **发币 vs 开盘**:
  * **Minting (印钞)**: 代币生成在项目方钱包，不可交易，无价值。
  * **Trading (开盘)**: 项目方将 **代币 + SOL** 存入 DEX (如 Raydium) 组建流动性池 (LP)，市场定价形成。
* **机器人的绝对优势**:
  * **速度**: 人手操作（看推特 -> 点链接 -> 连钱包 -> 签名）需 5-15 秒。Solana 理论出块 400ms，几秒差价可能百倍。
  * **执行**: 监听链上信号，毫秒级响应，实现“第 0 区块”买入。
  * **防夹 (MEV Protection)**: 使用 Jito 专用网络，避免遭受三明治攻击。

### 2. 狙击流派 (Strategies)

不同流派的风险与收益对比：

| 流派 | 监听信号 | 核心原理 | 优点 | 缺点/风险 |
| :--- | :--- | :--- | :--- | :--- |
| **流动性狙击** (Liquidity Sniping) | `InitializePool` 日志 | 监听 DEX 加池子动作，第一时间买入 | 价格最低，买点最早 | **极高风险**。容易遇撤池 (Rug)、貔貅盘。需极强安全检查。 |
| **盲狙** (Blind Sniping) | `Create` 指令 | 针对 Pump.fun 等内盘，建盘即买 | 速度最快 | **归零率 99.9%**。基本靠“刮彩票”，或跟随“聪明钱”地址。 |
| **授权狙击** (Authority Sniping) | `SetAuthority (None)` / `Burn` | 等待项目方**放弃权限**或**烧毁 LP**后再进场 | **安全性高** | 价格已上涨，利润空间较小。适合大资金稳健操作。 |

### 3. 网络架构与通信机制

* **无 Mempool (内存池)**:
  * Ethereum 有公开 Mempool，所有节点可见。
  * Solana 采用 **Gulf Stream**，交易直接发给当前的 **Leader** (通过排班表计算 IP)。这也导致了 UDP 丢包和垃圾交易轰炸。
* **Jito (Solana's Flashbots)**:
  * **机制**: 类似 VIP 通道。用户支付小费 (Tip) 给 Validator 换取交易打包权。
  * **特点**:
        1. **原子性 (Atomicity)**: Bundle 交易包要么全上，要么全不上（防止“买入成功但卖出失败”）。
        2. **No Land, No Pay**: 只有交易上链才扣小费。
        3. **防夹 (Private)**: 绕过公共网络，Searcher 无法监听你的交易意图。

### 4. 极速开发技术栈

* **监听 (Websocket)**:
  * 拒绝 `polling` (轮询)，延迟太高。应使用 `connection.onLogs` 建立长连接。
  * **Commitment**: 设置为 `processed` (收到即推送)，而非 `confirmed` 或 `finalized`。
* **双跳优化 (Double Hop)**:
  * *问题*: 监听到 Log 后，Log 数据不全，需再请求一次 `getTransaction` 才能拿到 Mint 地址，导致延迟。
  * *解法*: 使用支持 **Geyser 插件 (gRPC)** 的节点，或者利用专用 RPC 的增强 API，一次推送完整数据。
* **优先费 (Priority Fee)**:
  * 必须动态计算。根据当前区块中位数费率 * 1.5 或 2 倍，确保在 Leader 的处理队列中靠前。

### 5. 安全检查 (Security & Honeypots)

在自动化买入前，必须执行的安全检查清单：

* [ ] **Mint Authority 丢弃**: 检查是否为 `None`。否则项目方可无限增发砸盘。
* [ ] **Freeze Authority 丢弃**: 检查是否为 `None`。否则账户可被冻结（貔貅）。
* [ ] **LP 状态**: 检查 LP Token 是否已**烧毁**或**锁定**。否则项目方可撤池跑路。
* [ ] **持仓分布**: 检查 Top 10 持仓是否过于集中 (>30%) 或来自关联钱包（老鼠仓）。
* [ ] **交易模拟**: 使用 `simulateTransaction` 模拟买入+卖出。若卖出失败，则是貔貅代码。

---

## 第二部分：Solana Token 开发原理与实战

**主讲人**: 潘立雄 (泰迪熊)

### 1. Solana 账户模型 (Account Model)

Solana 采用“程序与数据分离”的架构。只能通过 **Account** 存储状态。

| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| `Pubkey` | 地址 | 账户的唯一标识 ID |
| `Lamports` | `u64` | 余额 (SOL) |
| `Data` | `Vec<u8>` | **实际数据** (如 Token 余额、NFT 元数据) |
| `Owner` | `Pubkey` | **所有者** (只有 Owner 程序能修改 Data) |
| `Executable`| `bool` | 是否为可执行代码 (合约) |

### 2. Token 账户体系 (SPL Token)

在 Solana 上持有代币，实际上是拥有一个 **ATA (Associated Token Account)**。

* **Mint Account (铸币账户)**: 定义 Token 的元数据（供应量、小数位）。
* **ATA (关联账户)**:
  * 公式: `ATA = Hash(User_Wallet, Mint_Address, Token_Program)`
  * **作用**: 用户的代币余额存储在这个 ATA 的 `Data` 字段中，而不是 User Wallet 本身。
* **Metadata Account**: 存储代币名称、Logo URI (通过 Metaplex 标准)。

### 3. 实战：发行与管理 Token

#### 方法 A: 命令行 (CLI)

适合快速测试。

```bash
# 1. 创建 Token (Mint)
spl-token create-token
# Output: Address: <MINT_ADDRESS>

# 2. 创建自己的 ATA 账户
spl-token create-account <MINT_ADDRESS>

# 3. 铸币 (给自己的 ATA 发钱)
spl-token mint <MINT_ADDRESS> 1000
```

#### 方法 B: Web3.js 代码交互

适合 DApp 开发。需使用 `@solana/spl-token` 库。

```typescript
import { createMint, getOrCreateAssociatedTokenAccount, mintTo, transfer } from '@solana/spl-token';

// 1. 创建 Mint (印钞机)
const mint = await createMint(
    connection,
    payer,           // 支付手续费的人
    mintAuthority,   // 铸币权限拥有者
    freezeAuthority, // 冻结权限 (可选)
    9                // 小数位 (通常是 9 或 6)
);

// 2. 获取或创建接收方的 ATA
// (如果对方没有 ATA，这步会自动帮他创建，需要 payer 付租金)
const tokenAccount = await getOrCreateAssociatedTokenAccount(
    connection,
    payer,
    mint,
    payer.publicKey // 接收人
);

// 3. 铸币 (Mint To)
await mintTo(
    connection,
    payer,
    mint,
    tokenAccount.address,
    authority,
    1000 * 10**9 // 数量 (注意补齐精度)
);
```

### 4. Token-2022 (Extensions)

新一代 Token 标准，旨在解决旧标准功能单一的问题。

* **原生功能**: 链上转账税 (Tax)、生息 (Interest Bearing)、不可转移 (Soulbound)。
* **Metadata**: 直接集成在 Token 账户中，无需依赖外部 Metaplex 合约。
* **隐私**: Confidential Transfer (基于零知识证明隐藏金额)。
